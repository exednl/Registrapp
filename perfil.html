<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style2.css">
    <title>Document</title>
</head>

<body>
    
    <nav>
        <a href="#" id="logoutButton">Logout</a>
        <a href="#" id="profile">Perfil de Usuario</a>
    </nav>

    <div class="form">
        <div>
            <img src="img/asignaturas.png">
        </div>
        <h2 class="form__title">Asignaturas y Secciones</h2>
        <div class="form__container">
            <table id="dataTable"></table>
        </div>
    </div>

    <script type="module">
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";
  
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB67XMBnKbUSZUz-2UKFOjW-hc36Cc7YpA",
            authDomain: "registrapp-3ea1b.firebaseapp.com",
            databaseURL: "https://registrapp-3ea1b-default-rtdb.firebaseio.com",
            projectId: "registrapp-3ea1b",
            storageBucket: "registrapp-3ea1b.appspot.com",
            messagingSenderId: "924476188769",
            appId: "1:924476188769:web:5b499bf3316d4188dbe220"
        };
  
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore();
        const docRef = doc(db, "users", "LhBXnJOCs6MzuCNs2yEE");
        const auth = getAuth();
  
        (async () => {
            const docSnap = await getDoc(docRef);
            const dataTable = document.getElementById("dataTable");

            if (docSnap.exists()) {
                const data = docSnap.data();
                const tableContent = Object.entries(data).map(([key, value]) => `
                    <tr>
                        <td>${key}</td>
                        <td>${value}</td>
                        ${key === 'Asignatura1' || key === 'Asignatura2' ? `<td><button class="actionButton" data-field="${key}">Registrar Asistencia</button></td>` : ''}
                    </tr>
                `).join('');

                dataTable.innerHTML = `
                    <thead>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableContent}
                    </tbody>    
                `;

                const actionButtons = document.querySelectorAll('.actionButton');
                actionButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const fieldName = this.dataset.field;
                        // Puedes redirigir a diferentes páginas según el campo presionado
                        if (fieldName === 'Asignatura1') {
                            window.location.href = "asistencia.html";
                        } else if (fieldName === 'Asignatura2') {
                            window.location.href = "asistencia2.html";
                        }
                    });
                });
            } else {
                dataTable.innerHTML = "<p>No data found</p>";
            }
        })();

        document.getElementById('logoutButton').addEventListener('click', () => {
            auth.signOut().then(() => {
                console.log("Usuario cerró sesión");
                window.location.href = "login.html";
            }).catch((error) => {
                console.error("Error al cerrar sesión:", error);
            });
        });

        auth.onAuthStateChanged((user) => {
            if (!user) {
                // El usuario no está autenticado, redirige a la página de inicio de sesión
                window.location.href = "login.html";
            }
        });

        document.getElementById('profile').addEventListener('click', redirectToProfile);

        function redirectToProfile() {
            // Redirigir a la página de perfil de usuario
            window.location.href = "profile.html";
        }
    </script>
    
</body>
</html>
